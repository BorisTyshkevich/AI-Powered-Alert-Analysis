<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Top Priority Alerts Dashboard - Last 4 Months</title>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- PapaParse for CSV parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js" integrity="sha384-D/t0ZMqQW31H3az8ktEiNb39wyKnS82iFY52QPACM+IjKW3jDUhyIgh2PApRqJZs" crossorigin="anonymous"></script>
    
    <!-- SortableJS for drag & drop -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #2c3e50;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.95;
        }
        
        .content {
            padding: 40px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .stat-value {
            font-size: 2.2em;
            font-weight: 700;
        }
        
        .chart-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            position: relative;
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .chart-type-selector {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.85em;
            cursor: pointer;
            background: white;
        }
        
        .btn-hide {
            display: none;
            padding: 6px 12px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            margin-left: 10px;
        }
        
        body.edit-mode .btn-hide {
            display: inline-block;
        }
        
        body.edit-mode .chart-header {
            cursor: grab;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
        }
        
        .chart-container-small {
            position: relative;
            height: 300px;
        }
        
        .secondary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .control-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.95em;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }
        
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: transform 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }
        
        .btn-secondary {
            background: #ecf0f1;
            color: #2c3e50;
        }
        
        .btn-export {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            color: white;
        }
        
        .data-table-container {
            margin-top: 30px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }
        
        .data-table thead {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            color: white;
        }
        
        .data-table th,
        .data-table td {
            padding: 14px 16px;
            text-align: left;
            border: 1px solid #ecf0f1;
        }
        
        .data-table th {
            font-weight: 600;
            cursor: pointer;
            user-select: none;
        }
        
        .data-table th:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .data-table tbody tr:hover {
            background: #f8f9fa;
        }
        
        .badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            display: inline-block;
        }
        
        .badge-p1 {
            background: #fee;
            color: #e74c3c;
        }
        
        .badge-p2 {
            background: #fef5e7;
            color: #f39c12;
        }
        
        .hidden {
            display: none;
        }
        
        .chart-card--ghost {
            opacity: 0.3;
        }
        
        .chart-card--dragging {
            transform: rotate(3deg);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }
        
        .chart-card--hidden {
            display: none !important;
        }
        
        .chart-trash {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3em;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            z-index: 1000;
        }
        
        .chart-trash.active {
            display: flex;
        }
        
        .hidden-charts-notice {
            padding: 15px 25px;
            background: #fff3cd;
            border-left: 4px solid #f39c12;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        
        .hidden-charts-notice.visible {
            display: block;
        }
        
        .restore-btn {
            padding: 8px 16px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Top Priority Alerts Dashboard</h1>
            <p>Analysis of P1/P2 alerts by type and organization across production environments (Last 4 Months: July 5 - Nov 5, 2025)</p>
        </div>
        
        <div class="content">
            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Alerts</div>
                    <div class="stat-value" style="color: #9b59b6;" id="stat-total">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">P1 Critical</div>
                    <div class="stat-value" style="color: #e74c3c;" id="stat-p1">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">P2 High</div>
                    <div class="stat-value" style="color: #f39c12;" id="stat-p2">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Unique Clusters</div>
                    <div class="stat-value" style="color: #3498db;" id="stat-clusters">-</div>
                </div>
            </div>
            
            <!-- Hidden Charts Notice -->
            <div class="hidden-charts-notice" id="hiddenCharts">
                <strong>Hidden Charts</strong>
                <button class="restore-btn" id="restoreHiddenBtn">Restore All</button>
            </div>
            
            <!-- Primary Chart -->
            <div id="primarySlot">
                <div class="chart-card" data-chart-id="chart1">
                    <div class="chart-header">
                        <h3 class="chart-title">Top 25 Alert Types by Frequency</h3>
                        <div>
                            <select class="chart-type-selector" data-chart-target="chart1">
                                <option value="horizontalBar">Horizontal Bar</option>
                                <option value="bar">Vertical Bar</option>
                                <option value="doughnut">Doughnut</option>
                                <option value="line">Line</option>
                            </select>
                            <button class="btn-hide" data-chart-action="hide" data-chart-target="chart1">‚úï</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="chart1"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Secondary Charts Grid -->
            <div class="secondary-grid" id="secondaryGrid">
                <div class="chart-card" data-chart-id="chart2">
                    <div class="chart-header">
                        <h3 class="chart-title">Top 15 Organizations by Alert Count</h3>
                        <div>
                            <select class="chart-type-selector" data-chart-target="chart2">
                                <option value="horizontalBar">Horizontal Bar</option>
                                <option value="bar">Vertical Bar</option>
                                <option value="doughnut">Doughnut</option>
                            </select>
                            <button class="btn-hide" data-chart-action="hide" data-chart-target="chart2">‚úï</button>
                        </div>
                    </div>
                    <div class="chart-container-small">
                        <canvas id="chart2"></canvas>
                    </div>
                </div>
                
                <div class="chart-card" data-chart-id="chart3">
                    <div class="chart-header">
                        <h3 class="chart-title">P1 vs P2 Distribution</h3>
                        <div>
                            <select class="chart-type-selector" data-chart-target="chart3">
                                <option value="doughnut">Doughnut</option>
                                <option value="bar">Bar</option>
                                <option value="horizontalBar">Horizontal Bar</option>
                            </select>
                            <button class="btn-hide" data-chart-action="hide" data-chart-target="chart3">‚úï</button>
                        </div>
                    </div>
                    <div class="chart-container-small">
                        <canvas id="chart3"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Controls -->
            <div class="controls">
                <div class="control-group">
                    <label for="filterAlert">Alert Type</label>
                    <select id="filterAlert">
                        <option value="">All Alert Types</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="filterEnv">Organization</label>
                    <select id="filterEnv">
                        <option value="">All Organizations</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="filterPriority">Priority</label>
                    <select id="filterPriority">
                        <option value="">All Priorities</option>
                        <option value="P1">P1 - Critical</option>
                        <option value="P2">P2 - High</option>
                    </select>
                </div>
                <div class="button-group">
                    <button class="btn btn-primary" id="applyFilters">Apply Filters</button>
                    <button class="btn btn-secondary" id="resetFilters">Reset</button>
                    <button class="btn btn-export" id="exportCSV">üì• Export CSV</button>
                </div>
            </div>
            
            <!-- Data Table -->
            <div class="data-table-container">
                <button class="btn btn-secondary" id="toggleTable">Show Data Table</button>
                <div class="hidden" id="tableWrapper">
                    <table class="data-table" id="dataTable">
                        <thead>
                            <tr>
                                <th data-sort="alert">Alert Type</th>
                                <th data-sort="environment">Organization</th>
                                <th data-sort="cluster_env">Cluster/Env</th>
                                <th data-sort="alert_count">Alert Count</th>
                                <th data-sort="p1_count">P1</th>
                                <th data-sort="p2_count">P2</th>
                                <th data-sort="first_seen">First Seen</th>
                                <th data-sort="last_seen">Last Seen</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Trash Zone -->
    <div class="chart-trash" id="chartTrash">üóëÔ∏è</div>
    
    <!-- Embedded CSV Data -->
    <script type="text/csv" id="alertData">
alert,environment,cluster_env,alert_count,unique_clusters,p1_count,p2_count,first_seen,last_seen
ClickHouseMaxPartCountForPartition,quantum-labs-569,sirius-150/quantum-labs-569,3071,1,0,3071,2025-07-14T06:06:08Z,2025-10-11T11:47:09Z
ClickHouseDistributedFilesToInsertContinuouslyGrowing,prime-labs-156-stg,sirius-310-stg/prime-labs-156-stg,2332,1,0,2332,2025-07-11T17:08:07Z,2025-10-06T07:59:07Z
ClickHouseReplicasSumQueueSize,green-technologies-508-prod,kepler-866-prod/green-technologies-508-prod,792,1,0,792,2025-07-06T09:08:07Z,2025-10-09T09:56:09Z
ClickHouseMaxPartCountForPartition,nimbus-labs-168,sirius-150/nimbus-labs-168,518,1,0,518,2025-09-11T10:24:09Z,2025-10-11T11:40:08Z
ClickHouseDistributedFilesToInsertContinuouslyGrowing,nimbus-data-588-stg-eu,omega-257-us/nimbus-data-588-stg-eu,447,1,0,447,2025-07-12T19:50:06Z,2025-10-10T23:15:07Z
ClickHouseMemoryResidentUtilizationHigh,nimbus-labs-168,sirius-150/nimbus-labs-168,280,1,0,280,2025-09-12T23:38:20Z,2025-10-11T04:58:19Z
ClickHouseReplicasSumQueueSize,prime-labs-156-stg,sirius-310-stg/prime-labs-156-stg,238,1,0,238,2025-07-14T22:23:15Z,2025-10-06T17:47:17Z
ClickHouseRejectedInserts,nimbus-data-588-stg-eu,omega-257-us/nimbus-data-588-stg-eu,211,1,0,211,2025-08-06T15:47:07Z,2025-10-10T21:20:08Z
ClickHouseRejectedInserts,rapid-data-409-prod,apollo-740/rapid-data-409-prod,175,1,0,175,2025-08-15T15:43:07Z,2025-09-08T18:55:08Z
ClickHouseMaxPartCountForPartition,clear-insights-339,helios-655-stg/clear-insights-339,169,1,0,169,2025-07-11T14:49:07Z,2025-10-03T09:49:07Z
KubePersistentVolumeUsage,solid-labs-758-prod,zephyr-663/solid-labs-758-prod,152,1,0,152,2025-07-05T15:56:49Z,2025-10-10T14:29:51Z
ClickHouseReplicasSumQueueSize,prime-labs-216,pulsar-152-prod-us/prime-labs-216,140,1,0,140,2025-07-10T11:35:20Z,2025-10-06T16:08:20Z
AtherInsertedRowsCustomAlert,prime-labs-216,pulsar-152-prod-us/prime-labs-216,136,1,0,136,2025-07-05T18:14:21Z,2025-10-06T16:35:22Z
ClickHouseKafkaConsumerErrors,nova-systems-985,atlas-327/nova-systems-985,129,1,0,129,2025-07-09T05:49:13Z,2025-10-10T16:27:16Z
ClickHouseReplicasSumQueueSize,prime-partners-816-eu,sierra-518-eu/prime-partners-816-eu,124,1,0,124,2025-07-05T06:01:49Z,2025-10-11T04:53:49Z
ClickHouseMaxPartCountForPartition,rapid-labs-409,apollo-180/rapid-labs-409,119,1,0,119,2025-08-29T20:24:48Z,2025-09-04T14:23:48Z
ClickHouseReplicasSumQueueSize,prime-labs-216,zephyr-663/prime-labs-216,116,1,0,116,2025-09-30T10:53:21Z,2025-10-06T13:55:20Z
ClickHouseMaxPartCountForPartition,quantum-dynamics-959-prod,atlas-207-prod/quantum-dynamics-959-prod,115,1,0,115,2025-07-18T06:51:06Z,2025-09-13T18:37:06Z
ClickHouseReplicasSumQueueSize,quantum-dynamics-959-prod,atlas-207-prod/quantum-dynamics-959-prod,114,1,0,114,2025-07-17T22:22:07Z,2025-10-06T14:06:08Z
ClickHouseMaxPartCountForPartition,global-ventures-885,vega-611-stg/global-ventures-885,111,1,0,111,2025-07-26T05:47:10Z,2025-08-19T19:35:11Z
ZookeeperUnrecoverableErrors,prime-insights-516-us,vulcan-608-us/prime-insights-516-us,107,1,0,107,2025-07-05T03:30:13Z,2025-09-25T07:22:15Z
ClickHouseMaxPartCountForPartition,rapid-data-409-prod,apollo-740/rapid-data-409-prod,105,1,0,105,2025-08-15T15:44:08Z,2025-09-08T20:22:11Z
ClickHouseOperatorMetricsExporterDown,apex-dynamics-131,zephyr-663/apex-dynamics-131,103,1,0,103,2025-07-05T00:09:42Z,2025-10-11T00:06:42Z
ClickHouseReplicasSumQueueSize,solid-technologies-158-prod,atlas-607/solid-technologies-158-prod,103,1,0,103,2025-07-05T05:49:49Z,2025-10-11T06:06:49Z
ClickHouseDistributedFilesToInsertContinuouslyGrowing,nova-insights-370,atlas-127/nova-insights-370,100,1,0,100,2025-07-10T21:55:06Z,2025-09-17T13:44:07Z
ClickHouseServerDown,blue-works-102,omega-977-us/blue-works-102,96,1,0,96,2025-07-25T18:25:06Z,2025-07-30T19:43:06Z
ClickHouseTooManyMutations,quantum-insights-464,pulsar-672/quantum-insights-464,94,1,0,94,2025-07-05T08:08:07Z,2025-10-08T15:41:08Z
ClickHouseTooManyMutations,true-technologies-802-prod,vulcan-148-us/true-technologies-802-prod,94,1,0,94,2025-07-18T12:22:09Z,2025-09-16T15:52:12Z
ClickHouseKafkaCommitFailures,vertex-labs-106,vulcan-848-stg/vertex-labs-106,91,1,0,91,2025-07-05T17:09:49Z,2025-10-10T21:39:49Z
ClickHouseMetricsExporterFetchErrors,bright-works-242,pulsar-752/bright-works-242,90,1,0,90,2025-08-24T23:08:08Z,2025-09-25T20:15:07Z
KubePersistentVolumeUsage,clear-analytics-654,zephyr-663/clear-analytics-654,89,1,0,89,2025-07-07T16:55:49Z,2025-10-11T10:56:49Z
ClickHouseKafkaConsumerErrors,quantum-ventures-734-prod-us,onyx-493-prod-us/quantum-ventures-734-prod-us,88,1,0,88,2025-07-06T03:30:12Z,2025-10-10T07:11:14Z
ClickHouseKafkaConsumerErrors,vertex-labs-106,vulcan-848-stg/vertex-labs-106,85,1,0,85,2025-07-12T07:12:49Z,2025-10-11T00:56:50Z
ClickHouseKafkaCommitFailures,quantum-dynamics-119-prod,vector-839-prod/quantum-dynamics-119-prod,83,1,0,83,2025-07-06T05:36:11Z,2025-09-20T11:25:18Z
ClickHouseServerDown,nimbus-data-588-stg-eu,omega-257-us/nimbus-data-588-stg-eu,83,1,0,83,2025-07-16T07:14:06Z,2025-08-19T06:08:06Z
ClickHouseKafkaCommitFailures,nova-systems-985,atlas-327/nova-systems-985,77,1,0,77,2025-07-08T08:25:13Z,2025-10-09T17:23:15Z
ClickHouseDistributedFilesToInsertContinuouslyGrowing,green-technologies-508-prod,kepler-866-prod/green-technologies-508-prod,75,1,0,75,2025-07-07T06:34:06Z,2025-08-26T14:10:06Z
ClickHouseServerDown,clear-ventures-819-stg-us,vulcan-848-stg/clear-ventures-819-stg-us,69,1,0,69,2025-09-22T22:40:06Z,2025-09-23T13:26:06Z
ClickHouseReplicasSumQueueSize,global-systems-840-stg,titan-162-us/global-systems-840-stg,67,1,0,67,2025-07-05T00:47:10Z,2025-10-08T17:38:13Z
ClickHouseReplicasSumQueueSize,prime-insights-516-us,vulcan-608-us/prime-insights-516-us,65,1,0,65,2025-07-08T22:28:08Z,2025-09-25T21:03:11Z
ClickHouseDiskUsage,global-systems-840-stg,titan-162-us/global-systems-840-stg,64,1,0,64,2025-07-06T09:14:09Z,2025-10-08T19:01:18Z
ClickHouseKafkaCommitFailures,solid-labs-758-prod,atlas-407-prod/solid-labs-758-prod,62,1,0,62,2025-07-07T19:18:49Z,2025-10-02T10:35:50Z
ClickHouseReplicasSumQueueSize,true-technologies-802-prod,vulcan-148-us/true-technologies-802-prod,61,1,0,61,2025-07-17T05:58:07Z,2025-09-17T11:19:09Z
ClickHouseTooManyDetachedParts,rapid-ventures-409-prod,phoenix-484/rapid-ventures-409-prod,58,1,0,58,2025-07-14T23:03:10Z,2025-10-09T20:13:14Z
ClickHouseReplicasSumQueueSize,true-labs-352-us,aurora-829-us/true-labs-352-us,55,1,0,55,2025-07-30T07:37:49Z,2025-09-30T15:40:49Z
ClickHouseRejectedInserts,rapid-labs-409,apollo-180/rapid-labs-409,55,1,0,55,2025-08-30T03:43:48Z,2025-09-04T08:38:48Z
ClickHouseKafkaConsumerErrors,solid-labs-758-prod,atlas-407-prod/solid-labs-758-prod,55,1,0,55,2025-08-14T04:20:49Z,2025-10-02T10:35:50Z
ClickHouseTooManyDetachedParts,green-solutions-343-prod,zephyr-343-prod/green-solutions-343-prod,52,1,0,52,2025-07-07T21:18:16Z,2025-10-09T20:13:18Z
ClickHouseMaxPartCountForPartition,clear-solutions-954,kepler-246/clear-solutions-954,51,1,0,51,2025-07-11T05:43:06Z,2025-08-25T08:14:06Z
ClickHouseMetricsExporterFetchErrors,clear-partners-369,vega-271-test-us/clear-partners-369,50,1,0,50,2025-09-01T05:47:07Z,2025-09-24T13:34:08Z
ClickHouseServerDown,clear-partners-369,vega-271-test-us/clear-partners-369,50,1,0,50,2025-09-01T05:45:07Z,2025-09-24T13:32:08Z
ClickHouseTooManyDetachedParts,green-technologies-508-prod,kepler-866-prod/green-technologies-508-prod,50,1,0,50,2025-07-05T11:38:07Z,2025-09-19T00:24:09Z
ClickHouseKafkaConsumerErrors,bright-solutions-872-prod,zephyr-423-prod-us/bright-solutions-872-prod,48,1,0,48,2025-07-16T11:19:19Z,2025-10-10T15:03:22Z
ClickHouseReplicasSumQueueSize,quantum-labs-569,sirius-150/quantum-labs-569,48,1,0,48,2025-07-14T05:46:12Z,2025-10-11T07:23:17Z
ClickHouseMetricsExporterFetchErrors,prime-labs-216,aurora-429/prime-labs-216,46,1,0,46,2025-07-11T08:51:07Z,2025-10-07T09:37:07Z
ClickHouseMetricsExporterFetchErrors,clear-insights-249,cobalt-794/clear-insights-249,44,1,0,44,2025-07-30T04:02:47Z,2025-10-09T00:23:47Z
KubePersistentVolumeUsage,green-works-673,zephyr-663/green-works-673,44,1,0,44,2025-07-15T14:11:49Z,2025-08-25T01:56:50Z
ClickHouseMaxPartCountForPartition,global-solutions-525-prod-us,onyx-913/global-solutions-525-prod-us,44,1,0,44,2025-07-08T10:05:06Z,2025-10-10T18:47:07Z
ClickHouseServerDown,clear-insights-249,cobalt-794/clear-insights-249,42,1,0,42,2025-07-30T04:00:47Z,2025-10-09T00:24:47Z
KubeletDown,nimbus-technologies-123,zephyr-663/nimbus-technologies-123,42,1,42,0,2025-07-07T15:17:17Z,2025-10-06T11:47:17Z
KubePersistentVolumeUsage,clear-labs-579,zephyr-663/clear-labs-579,42,1,0,42,2025-07-15T12:03:49Z,2025-10-08T23:08:52Z
ClickHouseMetricsExporterFetchErrors,bright-insights-737-prod,onyx-933/bright-insights-737-prod,41,1,0,41,2025-07-29T23:06:05Z,2025-10-10T16:39:05Z
ZookeeperDigestMismatch,quantum-solutions-149,delta-816-prod/quantum-solutions-149,41,1,41,0,2025-09-24T08:21:16Z,2025-10-04T16:27:16Z
ClickHouseBackupFailed,vertex-works-331-eu,vega-971/vertex-works-331-eu,39,1,39,0,2025-08-03T03:16:01Z,2025-09-17T03:02:49Z
ClickHouseReplicasSumQueueSize,solid-labs-758-prod,atlas-407-prod/solid-labs-758-prod,38,1,0,38,2025-08-24T11:56:49Z,2025-10-02T11:56:49Z
CAErr,nimbus-analytics-663,zephyr-663/nimbus-analytics-663,38,1,0,38,2025-07-21T15:25:37Z,2025-09-28T12:33:37Z
ClickHouseMetricsExporterFetchErrors,vertex-works-331-eu,vega-971/vertex-works-331-eu,38,1,0,38,2025-08-04T12:41:48Z,2025-08-07T11:08:48Z
ClickHouseMetricsExporterFetchErrors,green-technologies-508-prod,kepler-866-prod/green-technologies-508-prod,38,1,0,38,2025-07-07T06:34:06Z,2025-10-09T09:53:06Z
ClickHouseStorageBufferErrorOnFlush,green-insights-238,kepler-826-prod/green-insights-238,38,1,0,38,2025-07-05T08:11:11Z,2025-07-08T01:40:11Z
ClickHouseMetricsExporterFetchErrors,blue-works-102,omega-977-us/blue-works-102,38,1,0,38,2025-07-25T18:50:06Z,2025-07-30T19:11:06Z
ClickHouseTooManyDetachedParts,clear-systems-474-stg-eu,pulsar-512-stg-eu/clear-systems-474-stg-eu,36,1,0,36,2025-07-06T14:12:10Z,2025-10-10T16:07:12Z
ClickHouseRejectedInserts,quantum-dynamics-959-prod,atlas-207-prod/quantum-dynamics-959-prod,34,1,0,34,2025-08-04T19:34:06Z,2025-09-04T00:50:06Z
ClickHouseKafkaCommitFailures,solid-labs-758-prod,atlas-207-prod/solid-labs-758-prod,34,1,0,34,2025-07-12T09:15:49Z,2025-10-09T10:59:50Z
ClickHouseDiskUsage,prime-labs-156-stg,sirius-310-stg/prime-labs-156-stg,33,1,0,33,2025-07-12T15:24:12Z,2025-10-06T22:03:26Z
ClickHouseMaxPartCountForPartition,clear-systems-909-us,titan-162-us/clear-systems-909-us,33,1,0,33,2025-07-07T18:31:07Z,2025-07-28T15:37:07Z
ClickHouseKafkaCommitFailures,bright-solutions-872-prod,zephyr-423-prod-us/bright-solutions-872-prod,32,1,0,32,2025-07-19T13:02:19Z,2025-09-27T21:09:28Z
ClickHouseMaxPartCountForPartition,clear-partners-369,vega-271-test-us/clear-partners-369,31,1,0,31,2025-09-15T08:03:16Z,2025-10-11T03:28:10Z
ClickHouseServerDown,prime-labs-156-stg,sirius-310-stg/prime-labs-156-stg,30,1,0,30,2025-07-17T09:53:07Z,2025-10-07T07:08:07Z
ClickHouseMetricsExporterFetchErrors,nimbus-data-588-stg-eu,omega-257-us/nimbus-data-588-stg-eu,30,1,0,30,2025-07-16T07:16:06Z,2025-10-10T23:14:06Z
ClickHouseTooBigReplicasSumQueueSize,prime-partners-816-eu,sierra-518-eu/prime-partners-816-eu,30,1,30,0,2025-07-16T07:17:49Z,2025-10-09T05:24:49Z
ClickHouseMaxPartCountForPartition,prime-labs-216,zephyr-663/prime-labs-216,30,1,0,30,2025-09-23T16:45:12Z,2025-10-06T05:37:11Z
ZookeeperUnrecoverableErrors,true-technologies-802-prod,vulcan-148-us/true-technologies-802-prod,30,1,0,30,2025-07-11T12:59:13Z,2025-09-16T15:48:15Z
KubePodNotReady,clear-ventures-969-prod,zephyr-663/clear-ventures-969-prod,29,1,0,29,2025-07-06T00:11:40Z,2025-10-05T03:00:41Z
ClickHouseDistributedFilesToInsertContinuouslyGrowing,apex-partners-551-prod,atlas-127/apex-partners-551-prod,28,1,0,28,2025-09-12T04:25:08Z,2025-10-10T14:07:06Z
ClickHouseDiskUsage,apex-insights-476,zephyr-823/apex-insights-476,28,1,0,28,2025-07-05T21:48:10Z,2025-08-08T23:48:10Z
ClickHouseServerDown,bright-solutions-557-eu,delta-996/bright-solutions-557-eu,28,1,0,28,2025-07-10T08:22:06Z,2025-08-05T06:51:06Z
ClickHouseReplicasSumQueueSize,vertex-works-331-eu,zephyr-723/vertex-works-331-eu,27,1,0,27,2025-07-25T13:37:49Z,2025-09-05T05:25:49Z
KubePersistentVolumeUsage,vertex-works-766-prod,zephyr-663/vertex-works-766-prod,27,1,0,27,2025-08-15T23:12:50Z,2025-08-22T21:01:50Z
KubeDaemonSetRolloutStuck,bright-technologies-482-prod,zephyr-663/bright-technologies-482-prod,27,1,27,0,2025-07-14T15:30:08Z,2025-10-01T07:35:08Z
ClickHouseDistributedFilesToInsertIncreasedFor8H,prime-labs-156-stg,sirius-310-stg/prime-labs-156-stg,26,1,26,0,2025-07-12T05:15:08Z,2025-08-06T19:10:08Z
ClickHouseKafkaRebalanceAssignment,rapid-data-559,atlas-567-test-us/rapid-data-559,25,1,0,25,2025-09-23T15:14:15Z,2025-09-24T05:24:16Z
ClickHouseServerDown,true-labs-352-us,aurora-829-us/true-labs-352-us,25,1,0,25,2025-07-19T07:14:47Z,2025-10-08T05:42:47Z
ClickHouseKafkaConsumerErrors,clear-systems-474-stg-eu,pulsar-512-stg-eu/clear-systems-474-stg-eu,25,1,0,25,2025-07-11T13:03:12Z,2025-10-10T13:21:14Z
ClickHouseTooBigReplicasMaxAbsoluteDelay,solid-labs-758-prod,atlas-407-prod/solid-labs-758-prod,25,1,25,0,2025-08-21T14:04:48Z,2025-10-02T11:28:48Z
KubeStatefulSetReplicasMismatch,nimbus-data-588-stg-eu,zephyr-663/nimbus-data-588-stg-eu,24,1,24,0,2025-07-16T07:37:25Z,2025-10-02T18:39:25Z
ClickHouseTooManyMutations,prime-insights-516-us,vulcan-608-us/prime-insights-516-us,24,1,0,24,2025-07-05T00:27:07Z,2025-08-29T06:42:09Z
ClickHouseMaxPartCountForPartition,green-solutions-343-prod,zephyr-343-prod/green-solutions-343-prod,24,1,0,24,2025-07-08T06:48:10Z,2025-10-10T07:03:10Z
ClickHouseKafkaCommitFailures,quantum-ventures-734-prod-us,onyx-493-prod-us/quantum-ventures-734-prod-us,24,1,0,24,2025-07-08T15:22:11Z,2025-10-03T05:45:13Z
ClickHouseMaxPartCountForPartition,solid-analytics-593,pulsar-652/solid-analytics-593,23,1,0,23,2025-08-28T12:50:06Z,2025-10-09T17:23:06Z
KubePersistentVolumeUsage,vertex-works-331-eu,zephyr-663/vertex-works-331-eu,23,1,0,23,2025-07-22T04:22:50Z,2025-09-19T02:45:52Z
</script>
    
    <script>
        // Utility functions
        const utils = {
            groupBy(list, key) {
                return list.reduce((acc, item) => {
                    const k = item[key] ?? 'Unknown';
                    (acc[k] ||= []).push(item);
                    return acc;
                }, {});
            },
            sumBy(list, key) {
                return list.reduce((sum, item) => sum + Number(item[key] ?? 0), 0);
            },
            orderBy(list, key, direction = 'desc') {
                return [...list].sort((a, b) => {
                    const left = a[key] ?? 0;
                    const right = b[key] ?? 0;
                    return direction === 'asc' ? left - right : right - left;
                });
            }
        };
        
        // Load CSV data
        function loadCSV(scriptId) {
            const csv = document.getElementById(scriptId).textContent;
            const parsed = Papa.parse(csv, {
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true
            });
            return parsed.data
                .filter(row => Object.values(row).some(v => v != null && v !== ''))
                .map(row => {
                    Object.keys(row).forEach(key => {
                        if (typeof row[key] === 'string' && !isNaN(row[key])) {
                            row[key] = Number(row[key]) || 0;
                        }
                    });
                    return row;
                });
        }
        
        let rawData = loadCSV('alertData');
        let filteredData = [...rawData];
        let charts = {};
        
        // Color palette
        const colors = ['#e74c3c', '#f39c12', '#9b59b6', '#3498db', '#1abc9c', 
                        '#e67e22', '#2ecc71', '#34495e', '#16a085', '#c0392b'];
        
        // Edit mode setup
        const isEditMode = new URLSearchParams(location.search).get('edit') === '1';
        const layoutStorageKey = 'alertDashboard::layout';
        const defaultLayout = { 
            primary: ['chart1'], 
            secondary: ['chart2', 'chart3'], 
            hidden: [] 
        };
        
        if (isEditMode) {
            document.body.classList.add('edit-mode');
        }
        
        // Update stats
        function updateStats(data) {
            const totalAlerts = utils.sumBy(data, 'alert_count');
            const p1Count = utils.sumBy(data, 'p1_count');
            const p2Count = utils.sumBy(data, 'p2_count');
            const uniqueClusters = new Set(data.map(d => d.cluster_env)).size;
            
            document.getElementById('stat-total').textContent = totalAlerts.toLocaleString();
            document.getElementById('stat-p1').textContent = p1Count.toLocaleString();
            document.getElementById('stat-p2').textContent = p2Count.toLocaleString();
            document.getElementById('stat-clusters').textContent = uniqueClusters.toLocaleString();
        }
        
        // Create chart
        function createChart(chartId, type, data, labels, title) {
            const canvas = document.getElementById(chartId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            if (charts[chartId]) {
                charts[chartId].destroy();
            }
            
            let config = {
                type: type === 'horizontalBar' ? 'bar' : type,
                data: {
                    labels: labels,
                    datasets: [{
                        label: title,
                        data: data,
                        backgroundColor: type === 'doughnut' ? colors : colors[0],
                        borderRadius: 8,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: { duration: 750 },
                    plugins: {
                        legend: { 
                            display: type === 'doughnut',
                            position: 'right'
                        }
                    }
                }
            };
            
            if (type === 'horizontalBar') {
                config.options.indexAxis = 'y';
            }
            
            if (type === 'line') {
                config.data.datasets[0].tension = 0.4;
                config.data.datasets[0].fill = false;
                config.data.datasets[0].borderColor = colors[0];
                config.data.datasets[0].backgroundColor = 'transparent';
            }
            
            if (type !== 'doughnut') {
                config.options.scales = {
                    x: {
                        grid: { color: '#f0f0f0' },
                        ticks: { font: { size: 11 } }
                    },
                    y: {
                        grid: { color: '#f0f0f0' },
                        ticks: { font: { size: 11 } }
                    }
                };
            }
            
            charts[chartId] = new Chart(ctx, config);
        }
        
        // Update charts
        function updateCharts(data) {
            // Chart 1: Top 25 Alert Types
            const alertGroups = utils.groupBy(data, 'alert');
            const alertSums = Object.entries(alertGroups).map(([alert, rows]) => ({
                alert,
                count: utils.sumBy(rows, 'alert_count')
            }));
            const topAlerts = utils.orderBy(alertSums, 'count', 'desc').slice(0, 25);
            
            const chart1Type = document.querySelector('[data-chart-target="chart1"]').value;
            createChart(
                'chart1',
                chart1Type,
                topAlerts.map(a => a.count),
                topAlerts.map(a => a.alert),
                'Alert Count'
            );
            
            // Chart 2: Top 15 Organizations
            const envGroups = utils.groupBy(data, 'environment');
            const envSums = Object.entries(envGroups).map(([env, rows]) => ({
                environment: env,
                count: utils.sumBy(rows, 'alert_count')
            }));
            const topEnvs = utils.orderBy(envSums, 'count', 'desc').slice(0, 15);
            
            const chart2Type = document.querySelector('[data-chart-target="chart2"]').value;
            createChart(
                'chart2',
                chart2Type,
                topEnvs.map(e => e.count),
                topEnvs.map(e => e.environment),
                'Alert Count'
            );
            
            // Chart 3: P1 vs P2 Distribution
            const totalP1 = utils.sumBy(data, 'p1_count');
            const totalP2 = utils.sumBy(data, 'p2_count');
            
            const chart3Type = document.querySelector('[data-chart-target="chart3"]').value;
            createChart(
                'chart3',
                chart3Type,
                [totalP1, totalP2],
                ['P1 Critical', 'P2 High'],
                'Priority Distribution'
            );
        }
        
        // Populate filters
        function populateFilters() {
            const alertTypes = [...new Set(rawData.map(d => d.alert))].sort();
            const environments = [...new Set(rawData.map(d => d.environment))].sort();
            
            const alertFilter = document.getElementById('filterAlert');
            alertTypes.forEach(alert => {
                const option = document.createElement('option');
                option.value = alert;
                option.textContent = alert;
                alertFilter.appendChild(option);
            });
            
            const envFilter = document.getElementById('filterEnv');
            environments.forEach(env => {
                const option = document.createElement('option');
                option.value = env;
                option.textContent = env;
                envFilter.appendChild(option);
            });
        }
        
        // Apply filters
        function applyFilters() {
            const alertFilter = document.getElementById('filterAlert').value;
            const envFilter = document.getElementById('filterEnv').value;
            const priorityFilter = document.getElementById('filterPriority').value;
            
            filteredData = rawData.filter(row => {
                let match = true;
                if (alertFilter && row.alert !== alertFilter) match = false;
                if (envFilter && row.environment !== envFilter) match = false;
                if (priorityFilter === 'P1' && (row.p1_count ?? 0) === 0) match = false;
                if (priorityFilter === 'P2' && (row.p2_count ?? 0) === 0) match = false;
                return match;
            });
            
            updateStats(filteredData);
            updateCharts(filteredData);
            renderTable(filteredData);
        }
        
        // Reset filters
        function resetFilters() {
            document.getElementById('filterAlert').value = '';
            document.getElementById('filterEnv').value = '';
            document.getElementById('filterPriority').value = '';
            filteredData = [...rawData];
            updateStats(filteredData);
            updateCharts(filteredData);
            renderTable(filteredData);
        }
        
        // Render table
        function renderTable(data) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            data.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${row.alert ?? '-'}</td>
                    <td>${row.environment ?? '-'}</td>
                    <td>${row.cluster_env ?? '-'}</td>
                    <td>${(row.alert_count ?? 0).toLocaleString()}</td>
                    <td>${row.p1_count > 0 ? `<span class="badge badge-p1">${row.p1_count}</span>` : '-'}</td>
                    <td>${row.p2_count > 0 ? `<span class="badge badge-p2">${row.p2_count}</span>` : '-'}</td>
                    <td>${row.first_seen ? new Date(row.first_seen).toLocaleDateString() : '-'}</td>
                    <td>${row.last_seen ? new Date(row.last_seen).toLocaleDateString() : '-'}</td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        // Export CSV
        function exportCSV() {
            const csv = Papa.unparse(filteredData);
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'alert_data.csv';
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // Chart type selector
        document.querySelectorAll('.chart-type-selector').forEach(select => {
            select.addEventListener('change', () => {
                updateCharts(filteredData);
            });
        });
        
        // Event listeners
        document.getElementById('applyFilters').addEventListener('click', applyFilters);
        document.getElementById('resetFilters').addEventListener('click', resetFilters);
        document.getElementById('exportCSV').addEventListener('click', exportCSV);
        
        document.getElementById('toggleTable').addEventListener('click', () => {
            const wrapper = document.getElementById('tableWrapper');
            const btn = document.getElementById('toggleTable');
            wrapper.classList.toggle('hidden');
            btn.textContent = wrapper.classList.contains('hidden') ? 'Show Data Table' : 'Hide Data Table';
        });
        
        // Table sorting
        document.querySelectorAll('[data-sort]').forEach(th => {
            th.addEventListener('click', () => {
                const key = th.dataset.sort;
                const direction = th.dataset.direction === 'asc' ? 'desc' : 'asc';
                th.dataset.direction = direction;
                
                filteredData = utils.orderBy(filteredData, key, direction);
                renderTable(filteredData);
            });
        });
        
        // Edit mode - drag and drop
        if (isEditMode && window.Sortable) {
            const primarySlot = document.getElementById('primarySlot');
            const secondaryGrid = document.getElementById('secondaryGrid');
            const chartTrash = document.getElementById('chartTrash');
            
            function enforcePrimaryCapacity(evt) {
                if (evt?.to !== primarySlot || primarySlot.children.length <= 1) return;
                const displaced = [...primarySlot.children].find(c => c !== evt.item);
                if (displaced) {
                    (evt.from !== chartTrash ? evt.from : secondaryGrid)?.appendChild(displaced);
                }
            }
            
            function refreshLayout() {
                requestAnimationFrame(() => {
                    Object.values(charts).forEach(chart => chart?.resize());
                    saveLayout();
                });
            }
            
            function showTrash() {
                chartTrash.classList.add('active');
            }
            
            function hideTrash() {
                chartTrash.classList.remove('active');
            }
            
            const baseOptions = {
                group: 'charts',
                animation: 200,
                handle: '.chart-header',
                draggable: '.chart-card',
                ghostClass: 'chart-card--ghost',
                dragClass: 'chart-card--dragging',
                fallbackOnBody: true,
                swapThreshold: 0.6,
                onStart: showTrash,
                onEnd(evt) {
                    hideTrash();
                    refreshLayout();
                },
                onAdd: enforcePrimaryCapacity
            };
            
            Sortable.create(primarySlot, baseOptions);
            Sortable.create(secondaryGrid, baseOptions);
            
            Sortable.create(chartTrash, {
                group: { name: 'charts', pull: false, put: true },
                animation: 150,
                sort: false,
                onAdd(evt) {
                    if (confirm('Hide this chart?')) {
                        evt.item.classList.add('chart-card--hidden');
                        updateHiddenNotice();
                        saveLayout();
                    }
                }
            });
            
            // Hide button functionality
            document.querySelectorAll('[data-chart-action="hide"]').forEach(btn => {
                btn.addEventListener('click', () => {
                    const chartId = btn.dataset.chartTarget;
                    const card = document.querySelector(`[data-chart-id="${chartId}"]`);
                    if (card && confirm('Hide this chart?')) {
                        card.classList.add('chart-card--hidden');
                        updateHiddenNotice();
                        saveLayout();
                    }
                });
            });
            
            // Restore hidden charts
            document.getElementById('restoreHiddenBtn').addEventListener('click', () => {
                document.querySelectorAll('.chart-card--hidden').forEach(card => {
                    card.classList.remove('chart-card--hidden');
                    secondaryGrid.appendChild(card);
                });
                updateHiddenNotice();
                refreshLayout();
            });
            
            function updateHiddenNotice() {
                const hiddenCount = document.querySelectorAll('.chart-card--hidden').length;
                const notice = document.getElementById('hiddenCharts');
                if (hiddenCount > 0) {
                    notice.classList.add('visible');
                } else {
                    notice.classList.remove('visible');
                }
            }
            
            function saveLayout() {
                const layout = {
                    primary: [...primarySlot.children].map(c => c.dataset.chartId),
                    secondary: [...secondaryGrid.children].map(c => c.dataset.chartId),
                    hidden: [...document.querySelectorAll('.chart-card--hidden')].map(c => c.dataset.chartId)
                };
                localStorage.setItem(layoutStorageKey, JSON.stringify(layout));
            }
            
            function loadLayout() {
                const saved = localStorage.getItem(layoutStorageKey);
                const layout = saved ? JSON.parse(saved) : defaultLayout;
                
                // Restore primary
                layout.primary.forEach(id => {
                    const card = document.querySelector(`[data-chart-id="${id}"]`);
                    if (card) primarySlot.appendChild(card);
                });
                
                // Restore secondary
                layout.secondary.forEach(id => {
                    const card = document.querySelector(`[data-chart-id="${id}"]`);
                    if (card) secondaryGrid.appendChild(card);
                });
                
                // Restore hidden
                layout.hidden.forEach(id => {
                    const card = document.querySelector(`[data-chart-id="${id}"]`);
                    if (card) card.classList.add('chart-card--hidden');
                });
                
                updateHiddenNotice();
            }
            
            loadLayout();
        }
        
        // Initialize
        populateFilters();
        updateStats(filteredData);
        updateCharts(filteredData);
        renderTable(filteredData);
    </script>
</body>
</html>
